language: python

python:
#  - '2.7'
  - '3.3'

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -y liblua5.1-dev

install:
  - if [[ $TRAVIS_PYTHON_VERSION == '2.6' ]]; then pip install ordereddict unittest2; fi
  - pip install six
  - mkdir ~/.pywikibot

  - touch ~/.pywikibot/user-config.py
  - echo "import os" >> ~/.pywikibot/user-config.py
  - echo "mylang = '$LANGUAGE'" >> ~/.pywikibot/user-config.py
  - echo "family = '$FAMILY'" >> ~/.pywikibot/user-config.py
  - echo "usernames['$FAMILY']['$LANGUAGE'] = 'Pywikibot-test'" >> ~/.pywikibot/user-config.py
  - echo "usernames['wikipedia']['en'] = 'Pywikibot-test'" >> ~/.pywikibot/user-config.py
  - echo "usernames['wikipedia']['test'] = 'Pywikibot-test'" >> ~/.pywikibot/user-config.py
  - echo "usernames['wikidata']['test'] = 'Pywikibot-test'" >> ~/.pywikibot/user-config.py
  - echo "password_file = os.path.expanduser('~/.pywikibot/passwordfile')" >> ~/.pywikibot/user-config.py
  - echo "max_retries = 2" >> ~/.pywikibot/user-config.py

  - touch ~/.pywikibot/passwordfile
  - echo "('XZise', '"$USER_PASSWORD"')" > ~/.pywikibot/passwordfile

  - cd externals/httplib2
  - python setup.py install
  - cd ../..

  - export PYWIKIBOT2_DIR=$HOME/.pywikibot
  - if [[ $TRAVIS_PYTHON_VERSION == '3.3' ]]; then export PY3=1; fi
  - python -c "import setuptools; print(setuptools.__version__)"

script:
#  - if [[ "$USE_NOSE" == "1" ]]; then nosetests -v -a '!site,!net' tests; else python setup.py test; fi
  - python pwb.py tests/site_tests.py -vcf

env:
  global:
    # This is the encrypted password, which can only be decrypted by Travis itself
    # See http://docs.travis-ci.com/user/encryption-keys/
    # And http://docs.travis-ci.com/user/build-configuration/#Secure-environment-variables
    # Command use to generate: travis encrypt USER_PASSWORD=<pwd> -r wikimedia/pywikibot-core
    - secure: "TgPBY2xBwjVLA1t8wUP2dfY2ibqf4HVrnBYzYJCVWbxFgMoNTPgye5uIGG5w0f9iyv6hPtdCfKazq79ILKhM/T36EeFwgFWKl708ZDpkMGm/WwhmoKAXVNClpLf5cMN3PPmtiB3QQHfUb130ke74toETKOsRbXJXE+uTaunR48E="
  matrix:
    - LANGUAGE=en FAMILY=wikipedia
notifications:
  email: false
